---
import { Picture } from 'astro:assets';
import { getDataCollectionImage, getDataCollectionEntry } from '@utils/utils';

const slug = Astro.props.slug;
const size = Astro.props.size || "sm";
const categoryURL = `/categories/${slug}`;
// abstracted to allow merging of data from db
const category = await getDataCollectionEntry('categories', slug);

let imageSize
if (size === "sm") imageSize = {width: 400, height: 400, format: 'webp'}
 else if (size === "md") imageSize = {width: 800, height: 400, format: 'webp'}
 else imageSize = {width: 1700, height: 900, format: 'webp'}
const image = await getDataCollectionImage(category, category.data.image, imageSize);
const categoryName = category.data.category;

const uniqueID = 'id-' + Math.random().toString(36).slice(2, 11);
---

{(size==="sm" && image) && (
 <div id={uniqueID} class="categoryCard w-48 h-48 shadow-lg rounded-lg overflow-hidden mx-auto border-2 border-gray-200 p-1">
  <a href={categoryURL} aria-label={categoryName}>
    <div class="relative h-full">
      <Picture src={!!image.isExternal ? image.src : image}
      class="w-full h-full object-cover rounded-md" alt={categoryName}
      width={image.width} height={image.height}
      />
      <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-35 rounded-b-lg">
        <div class="text-white px-1 py-1">
          <h3 class="text-sm font-semibold">{categoryName}</h3>
          <h3 class="text-xs"></h3>
        </div>
      </div>
    </div>
  </a>
 </div>
)}

{(size==="md" && image) && (
 <div id={uniqueID} class="categoryCard w-96 h-48 shadow-lg rounded-lg overflow-hidden mx-auto border-2 border-gray-200 p-1">
  <a href={categoryURL} aria-label={categoryName}>
    <div class="relative h-full">
      <Picture src={!!image.isExternal ? image.src : image}
        class="w-full h-full object-cover rounded-md" alt={categoryName}
        width={image.width} height={image.height}
      />
      <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-35 rounded-b-lg">
        <div class="text-white px-1 py-1">
          <h3 class="text-sm font-semibold">{categoryName}</h3>
          <h3 class="text-xs"></h3>
        </div>
      </div>
    </div>
  </a>
 </div>
)}

{(size==="lg" && image) && (
 <div id={uniqueID} class="categoryCard w-[800px] h-[300px] shadow-lg rounded-lg overflow-hidden mx-auto border-2 border-gray-200 p-1">
  <a href={categoryURL} aria-label={categoryName}>
    <div class="relative h-full">
      <Picture src={!!image.isExternal ? image.src : image}
      class="w-full h-full object-cover rounded-md" alt={categoryName}
      widths={[120, 188, 300, 372, 788, 1000, 1280]}
      width={image.width} height={image.height}
      />
      <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-35 rounded-b-lg">
        <div class="text-white px-1 py-1">
          <h3 class="text-sm font-semibold">{categoryName}</h3>
          <h3 class="text-xs"></h3>
        </div>
      </div>
    </div>
  </a>
 </div>
)}

