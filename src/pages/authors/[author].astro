---
export const prerender = true;
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import PostThumb from "@components/article/postThumb.astro";
import AuthorCard from "@components/article/authorCard.astro";

// export paths for all the authors
export async function getStaticPaths() {
  const authors = await getCollection("team", ({data}) => !data.draft);
  let paths = authors.map(({ data }) => ({ params: { author: data.name_slug } }));
  // console.log("Author paths: ", paths);
  return paths;
};

// this author param
const { author: thisAuthorSlug }= Astro.params;
const isPublished = ({data}) => (!data.draft && data.datePublished<=new Date());
const isDev = import.meta.env.APP_ENV==='dev';
const allPosts = await getCollection("posts", (ar) => isPublished(ar) || isDev);

// get all posts which are not in draft mode && match author
const posts = allPosts.filter((post) => post.data.author.id===thisAuthorSlug);
---

<Layout pageTitle={thisAuthorSlug}>
  <Container>

     <AuthorCard slug={thisAuthorSlug} size="md" />

      <main class="mt-16">
        <div class="flex flex-wrap justify-center gap-20">
          {Array.isArray(posts) && posts.map((post) => (
            <div class="flex-none articlePost"
                style={{ width: '300px' }}
                data-title={post.data.title}
                data-tags={post.data.tags.join(',')}
                data-language={post.data.language}>
              <PostThumb post={post} />
            </div>
          ))}
        </div>
      </main>

      <button class="mt-16 text-center block mx-auto bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">
        <a href="/authors" aria-label="All Authors">Back to Authors</a>
      </button>

  </Container>
</Layout>

<!-- {Array.isArray(posts) && posts.map((post) => (
  <div class="flex-none articlePost"
      data-title={post.data.title}
      data-tags={post.data.tags.join(',')}
      data-language={post.data.language}>
    <PostThumb post={post} />
  </div>
))} -->

<script type="text/javascript">
  // script to hide articles based on language
  document.addEventListener('DOMContentLoaded', function() {
    const selectedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    const articles = document.querySelectorAll('.articlePost');
    articles.forEach(article => {
      const language = article.dataset.language.toLowerCase();
      if (language === selectedLanguage)  article.classList.remove('hidden');
        else article.classList.add('hidden');
    });
  });
</script>


